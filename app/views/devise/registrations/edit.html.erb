<div class="container" >
  <div class="main-area">
    <h1>Update infos personnelles</h1>
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="registration-new">
          <%= bootstrap_devise_error_messages! %>
          <div class="panel panel-default devise-bs">         
            <div class="panel-body">                     
              <%= form_for(resource, as: resource_name, url: registration_path(resource_name), :html => { role: 'form', multipart: :true, class: 'form-horizontal', id: "reg_form", method: "put" }) do |f| %>             
                <h3>Infos Personnelles: </h3>
                <div class="form-group">
                  <%= f.label :photo do %>
                    <%= f.label :photo, class: 'col-md-4 control-label' %>
                    <%= cl_image_tag current_user.photo, crop: :fill, id: "img-prev", alt: "your image"%>  
                    <div class="col-md-8  inputGroupContainer">
                      <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-camera"></i></span>
                        <%= f.file_field :photo, class: 'form-control'%>
                        <%= f.hidden_field :photo_cache, onchange: "readURL(this)" %>
                      </div>
                    </div>
                  <% end %>
                </div>
                <div class="form-group">
                  <%= f.label :first_name, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                      <%= f.text_field :first_name, autofocus: true, placeholder: "PrÃ©nom", class: 'form-control', type: "text", name: 'user[first_name]' %>
                    </div>
                  </div>
                </div>        
                <div class="form-group">
                  <%= f.label :last_name, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                      <%= f.text_field :last_name, class: 'form-control', placeholder: "Nom", name: 'user[last_name]' %>
                    </div>
                  </div>
                </div> 
                <div class="form-group">
                  <%= f.label :address, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                      <%= f.text_field :address, class: 'form-control', placeholder: "Adresse exacte", name: 'user[address]' %>
                    </div>
                  </div>
                </div> 
                <div class="form-group">
                  <%= f.label :postal_code, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                      <%= f.text_field :postal_code, class: 'form-control', placeholder: "Code postal", name: 'user[postal_code]' %>
                    </div>
                  </div>
                </div> 
                <div class="form-group">
                  <%= f.label :city, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                      <%= f.text_field :city, class: 'form-control', placeholder: "Ville", name: 'user[city]'%>
                    </div>
                  </div>
                </div> 
                <div class="form-group">
                  <%= f.label :country, class: 'col-md-4 control-label'%>
                  <div class="col-md-6  inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                      <%= f.text_field :country, class: 'form-control', placeholder: "Pays", name: 'user[country]' %>
                    </div>
                  </div>
                </div>
                <h3> Connexion: </h3>  
                <div class="form-group">
                    <%= f.label :email, class: 'col-md-4 control-label' %>
                  <div class="col-md-6 inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                        <%= f.email_field :email, autofocus: true, class: 'form-control', placeholder: "Email", name: "user[email]" %>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <%= f.label :password, class: 'col-md-4 control-label' %>
                  <div class="col-md-6 inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>            
                      <%= f.password_field :password, class: 'form-control', placeholder: "Password", name: 'user[password]', :input_html => {'data-minLength' => 6, hint: "leave it blank if you don't want to change it", autocomplete: "new-password" }, required: false %>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <%= f.label :password_confirmation, class: 'col-md-4 control-label'%>
                  <div class="col-md-6 inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                      <%= f.password_field :password_confirmation, class: 'form-control', placeholder: "Confirmation password", name: 'user[password_confirmation]', :input_html => { autocomplete: "new-password", required: false } %>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <%= f.label :current_password, class: 'col-md-4 control-label'%>
                  <div class="col-md-6 inputGroupContainer">
                    <div class="input-group"> <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                      <%= f.password_field :current_password, class: 'form-control', placeholder: "Password actuel", name: 'user[current_password]', :input_html => { autocomplete: "current-password", required: true , hint: "we need your current password to confirm your changes"} %>
                    </div>
                  </div>
                </div>            
                <%= f.submit 'Update', class: 'btn btn-primary' %>
              <% end %> 
                <h3>Cancel my account</h3>

<p>Unhappy? <%= link_to "Cancel my account", registration_path(resource_name), data: { confirm: "Are you sure?" }, method: :delete %></p>

<%= link_to "Back", :back %>  
            </div>           
          </div>
          <%= render 'devise/shared/links' %>
        </div>
      </div>
    </div>
  </div>
</div> 







<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js'></script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.4.5/js/bootstrapvalidator.min.js'></script>
 
        <script src="js/index.js"></script>
<script type="text/javascript">

function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {
            $('#img_prev')
              .attr('src', e.target.result)
              .width(150)
              .height(200);
          };

          reader.readAsDataURL(input.files[0]);
        }
      }
 
   $(document).ready(function() {
    $('#reg_form').bootstrapValidator({
        // To use feedback icons, ensure that you use Bootstrap v3.1.0 or later
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            'user[first_name]': {
                validators: {
                        stringLength: {
                        min: 2,
                    },
                        notEmpty: {
                        message: 'Please supply your first name'
                    }
                }
            },
            'user[last_name]': {
              validators: {
                    stringLength: {
                      min: 2,
                  },
                  notEmpty: {
                      message: 'Please supply your last name'
                  }
              }
            },
           
            'user[address]': {
                validators: {
                     stringLength: {
                        min: 8,
                    },
                    notEmpty: {
                        message: 'Please supply your street address'
                    }
                }
            },
            'user[city]': {
                validators: {
                     stringLength: {
                        min: 4,
                    },
                    notEmpty: {
                        message: 'Please supply your city'
                    }
                }
            },
            'user[postal_code]': {
                validators: {
                    notEmpty: {
                        message: 'Please supply your zip code'
                    },
                    zipCode: {
                        country: 'US',
                        message: 'Please supply a vaild zip code'
                    }
                }
            },
            'user[country]': {
                validators: {
                    notEmpty: {
                        message: 'Please select your country'
                    }
                }
            },
            
	
	          'user[email]': {
                validators: {
                    notEmpty: {
                        message: 'Please supply your email address'
                    },
                    emailAddress: {
                        message: 'Please supply a valid email address'
                    }
                }
            },
					
	          'user[password]': {
              validators: {
                stringLength: {
                        min: 6,
                    },
                identical: {
                    field: 'user[password_confirmation]',
                    message: 'Confirm your password below - type same password please'
                }
              }
            },
            'user[password_confirmation]': {
              validators: {
                identical: {
                    field: 'user[password]',
                    message: 'The password and its confirm are not the same'
                }
              }
            },           
        }
     })
		
 	
        .on('success.form.bv', function(e) {
            $('#success_message').slideDown({ opacity: "show" }, "slow") // Do something ...
                $('#reg_form').data('bootstrapValidator').resetForm();
 
            // Prevent form submission
            e.preventDefault();
 
            // Get the form instance
            var $form = $(e.target);
 
            // Get the BootstrapValidator instance
            var bv = $form.data('bootstrapValidator');
 
            // Use Ajax to submit form data
            $.post($form.attr('action'), $form.serialize(), function(result) {
                console.log(result);
            }, 'json');
        });
});
 
 
 
 </script>
