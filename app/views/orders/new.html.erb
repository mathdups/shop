<div class="container">
  <div class="row">
    <h1> Résumé de votre commande </h1>
    <div class="col-xs-12 col-sd-12 col-md-6 ">
    	<h2> Info commande en cours</h2>  
        <% current_cart.order.items.each do |item| %>
            <h3><%= item.product.category.title %> </h3>
            <h5>Name: <%= item.product.title %><h5>
            <p>Price: <%= item.product.price %> Quantity: <%= item.quantity.to_i %></p>
            <% end %>
            <br>
            <p>Sub-Total: <%= current_cart.sub_total %>€</p>
            <p>Shipping Cost: <%= current_cart.shipping_cost %>€</p>
            <p>TVA: <%= current_cart.tva %>€</p>
            <p>Price Total: <%= current_cart.price_total %>€</p>

      <%= link_to 'Modif Cart', cart_path, class: "btn btn-primary"%>
    </div>
    <div class="col-ld-12 col-md-6 col-sd-6 col-xs-6">
      
			<h2> Info Personnelles </h2>
			
				<p>Prénom:	<%= current_user.first_name %></p>
				<p>Nom:   	<%= current_user.last_name %></p>
				<p>Adresse: <%= current_user.address %></p>
				<p>Ville:		<%= current_user.city %></p>
				<p>Zip code:<%= current_user.postal_code %></p>
				<p>Pays:    <%= current_user.country %></p>

				<%= link_to 'Update', edit_user_registration_path, class: "btn btn-primary"%>
			

    </div>
	</div>

      <%= form_tag charges_path, id:'chargeForm' do %>

          <% if flash[:error].present? %>
            <div id="error_explanation">
              <p><%= flash[:error] %></p>
            </div>
          <% end %>
        <%= hidden_field_tag 'stripeToken' %>
        <%= hidden_field_tag 'stripeEmail' %> 
        <%= hidden_field_tag 'amount', current_cart.price_stripe.to_i %>
        <button id="btn-buy" type="btn" class="btn btn-success btn-lg btn-block"><span class="glyphicon glyphicon-ok"></span>Buy this!</button>
  <% end%> 
</div> 

  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js'></script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.4.5/js/bootstrapvalidator.min.js'></script>



  <script >
    var handler = StripeCheckout.configure({
      key: '<%= Rails.configuration.stripe[:publishable_key] %>',
      token: function(token, arg) {
        document.getElementById("stripeToken").value = token.id;
        document.getElementById("stripeEmail").value = token.email;

        document.getElementById("chargeForm").submit();
        }
  });
  document.getElementById('btn-buy').addEventListener('click', function(e) {
    handler.open({
      user: "Blabla",
      description: "Buy this item for 4.99$",
      status: '<%= current_cart.order.status %>',
      amount: document.getElementById("amount").value
      });
      e.preventDefault();
    })

  </script>

 


                

      
    


